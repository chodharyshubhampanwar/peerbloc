generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Signer {
  id         String      @id @default(uuid())
  name       String
  documents  Document[]
  publicKey  PublicKey?
  signatures Signature[]
}

model PublicKey {
  id         String      @id @default(uuid())
  key        String      @unique
  signerId   String      @unique
  signer     Signer      @relation(fields: [signerId], references: [id])
  status     String      @default("valid")
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  signatures Signature[]
}

model Document {
  id         String      @id @default(uuid())
  content    String
  code       String      @unique
  signerId   String
  signer     Signer      @relation(fields: [signerId], references: [id])
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  signatures Signature[]
}

model Signature {
  id          String    @id @default(uuid())
  signature   String
  documentId  String
  document    Document  @relation(fields: [documentId], references: [id])
  signerId    String
  signer      Signer    @relation(fields: [signerId], references: [id])
  publicKeyId String
  publicKey   PublicKey @relation(fields: [publicKeyId], references: [id])
  createdAt   DateTime  @default(now())
  isValid     Boolean   @default(true)
}
